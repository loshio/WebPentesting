# Bypassing Client-Side Controls

## Directory

**[Hidden Form Fields](#Hidden-Form-Fields)**<br>
**[HTTP Cookies](#HTTP-Cookies)**<br>
**[URL Parameters](#URL-Parameters)**<br>
**[The Referer Header](#The-Referer-Header)**<br>
**[The ASP.NET ViewState](#The-ASP.NET-ViewState)**<br>
**[Capturing User Data HTML Forms](#Capturing-User-Data-HTML-Forms)**<br>
**[Capturing User Data: Browser Extentions](#Capturing-User-Data:-Browser-Extentions)**<br>
**[Handling Client-Side Data Securely](#Handling-Client-Side-Data-Securely)**<br>
**[]()**<br>

## Hidden Form Fields

These are sometimes hidden parameters that a web app may send the user to send right back. Normally a cookie, these parameters can relate to forms. One example of this is a shopping site where the site sends the user the price of the object. You can't edit the price, but could edit it through a proxy such as burp suite. If the application doesn't check this, you could in theory by that object for free or .01c. Here is an example:

    
    <form method=”post” action=”Shop.aspx?prod=1”>
    Product: iPhone 5 <br/>
    Price: 449 <br/>
    Quantity: <input type=”text” name=”quantity”> (Maximum quantity is 50)
    <br/>
    <input type=”hidden” name=”price” value=”449”>
    <input type=”submit” value=”Buy”>
    </form>

Notice the price parameter as hidden, this means that it doesn't show up to the user.

## HTTP Cookies

Just like the hidden parameters with forms, there may be cookies that can be edited. Here is an example:

    HTTP/1.1 200 OK
    Set-Cookie: DiscountAgreed=25
    Content-Length: 1530

This may be a response that was given and the cookie may be sent in a POST request. Thus you may be able to change and get the discount even higher.

## URL Parameters

Web Apps may also use preset URL parameters. For example, with a product catalog hyperlink:

    http://mdsec.net/shop/?prod=3&pricecode=32

Thus you may be able to change to a different pricecode and change the price.

## The Referer Header

The Referer header exists to explain where the user originated from when making the request. In this regard, the user may change where the originated which could allow a request to go through. For instance:

    DeleteUser function(userName):
        if(refererHeader == 'admin.ashx'):
            deleteUser(userName);
        else:
            sendResponse(403);

Thus if you came from the admin page, the site may allow you to pass as you fit the criteria.

Note: The Referer header is considered completely optional according to w3.ord standards.

## The ASP.NET ViewState

Quick definition: Opaque Data
- Data that is present but could possibly be tampered with. Example (pricing_token):

Example Form:

    <form method=”post” action=”Shop.aspx?prod=4”>
    Product: Nokia Infinity <br/>
    Price: 699 <br/>
    Quantity: <input type=”text” name=”quantity”> (Maximum quantity is 50)
    <br/>
    <input type=”hidden” name=”price” value=”699”>
    <input type=”hidden” name=”pricing_token”
    value=”E76D213D291B8F216D694A34383150265C989229”>
    <input type=”submit” value=”Buy”>
    </form>

So, one mechanism that contains opaque data is the ASP.NET viewstate hidden field. The data is serialized data about the state of the current page. The reasons behind this is to:
- Enhance server performance
- Enables server to preserve elements within user interface across successive requests without needing to maintain all relavent state information on the server's side.

So developers may use the serialized data to hide different fields, such as price. So if you desererialize it: then you may edit it and reserialize it to send off.

## Capturing User Data HTML Forms

These are ways for an application to capture information from a user. Some developers try and create security mechanisms on the client side of this and thus can be bypassed.

### Length Limits

This may stop a person from putting in a value that is a greater character length than what the ```maxlength``` attribute is set to.

Thus:

    Quantity: <input type=”text” name=”quantity” maxlength=”1”>

The maxlength feature would only allow you to put 0-9 in the input bar.

To stop this, edit the html, or intercept a good request and modify it.

### Script-Based Validation

First and example:

    <form method=”post” action=”Shop.aspx?prod=2” onsubmit=”return
    validateForm(this)”>
    Product: Samsung Multiverse <br/>
    Price: 399 <br/>
    Quantity: <input type=”text” name=”quantity”> (Maximum quantity is 50)
    <br/>
    <input type=”submit” value=”Buy”>
    </form>
    <script>function validateForm(theForm)
    {
        var isInteger = /^\d+$/;
        var valid = isInteger.test(quantity) &&
            quantity > 0 && quantity <= 50;
        if (!valid)
            alert(’Please enter a valid quantity’);
        return valid;
    }
    </script>

Notice the "validateThis()" method is used when submitted by the "onsubmit" attribute. 

To get passed this, submit a known good answer and then use a proxy to change the request.

### Disabled Elements

Elements in a form may have a ```disabled=true``` tag. This will disallow a user to change the form from the broswer side. Here's an example:

    <form method=”post” action=”Shop.aspx?prod=5”>
    Product: Blackberry Rude <br/>
    Price: <input type=”text” disabled=”true” name=”price” value=”299”>
    <br/>
    Quantity: <input type=”text” name=”quantity”> (Maximum quantity is 50)
    <br/>
    <input type=”submit” value=”Buy”>
    </form>

Now when the form is submitted, only the "quantity" parameter will be submitted. But this could mean that at one time the price field may have been used. Thus try to submit the parameter and see what comes.

## Capturing User Data: Browser Extentions

The ones talked about in the books are all nearly deprecated. They include: Java Applets, Flash, and Silverlight. On one hand, yes, they still exist. But the other says: "don't waste time on legacy tech" as all the stuff coming out is not using these technologies.

## Handling Client-Side Data Securely

### Transitting Data Via the Client

If data is critical, then never rely on client side validation, only use server resources. Thus store prices within the server db, and reference with a product code. Only allow the user to edit the quanitity and productID.

But if there is no other options. (This means like 0.001% of the time, so don't think this is likely) Use some form of encryption or signing that only allows a cryptographically secure data through. But still, this can still be vulnerable to crypto attacks.

### Validating Client-Generated Data

This means that no data generated from the client should be validated/treated as secure.

### Logging and Alerting

When as app employs client and server side validation that are one and the same, if there is anything that is stopped at the server side should be logged and possibly alerted to site admins

