# Web Technologies

## Directory

**[HTTP](#HTTP)**<br>
**[URLs](#URLs)**<br>
**[REST](#REST)**<br>
**[HTTP Headers in Depth](#HTTP-Headers-in-Depth)**<br>
**[Cookies](#Cookies)**<br>
**[Status Codes](#Status-Codes)**<br>
**[HTTPS](#HTTPS)**<br>
**[HTTP Proxies](#HTTP-Proxies)**<br>
**[HTTP Authentication](#HTTP-Authentication)**<br>
**[Same Origin Policy](#Same-Origin-Policy)**<br>
**[Encoding Schemes](#Encoding-Schemes)**

## HTTP

HTTP requests always have the same few elements in the first line. These are a verb that indicates the HTTP method, the next is the requested resource(URL), and finally is the HTTP Version used. Example below

    GET /test/myscript.php?q=123 HTTP/1.1

#### Interesting points of interest within a request:

    Referer: (misspelled intentionally) indicates the URL from which the request originated.

    User-Agent: information about the browser or client software. (Mozilla has been in nearly all since Netscape)

    Host: Specifies the hostname that appears in the full url. (In HTTP 1.1, Host is required)

    Cookie: Submits additional parameters that the server has issued to the client.

First Line of HTTP Responses include:

1. HTTP Version used.
1. Numerical Status Code (200, 404, 500, etc)
1. A textual "reason phrase" such as "ok"

#### Interesting points of interest within a HTTP Response:


HTTP has a few methods that can be used: (These are some but not all)

    GET         
        For retrieving resourse. Can be used to send parameters to requested resource in url query string. These URLS are displayed on screen and logged in various places (browser history, web server's access logs). Transmitted in the Referer header to other sites when external links are followed. (So don't use quesry strings for transmitting sensitive data).

    POST        
        Designed to perform actions. Request parameters cab both be sent in the URL query string and in the body of the message. Parameters will be excluded from logs and the Referer header.

    HEAD        
        Get request with no body. Can be used to check if a resource is present

    TRACE       
        Used for diagnostic purposes. Sends back exact same thing as the request to see if proxy changes anything.

    OPTIONS     
        Asks the server for HTTP methods available for a resource.

    PUT         
        Attempts to upload a specified resource to the server using the content contained in the body of the request. If method is enabled, then scripts may be uploaded and leveraged.

## URLs

Uniform Resource Locator

    protocol://hostname[:port]/[path/]file[?param=value]

The port number is optional and defaults to whatever the protocal specifies: 80 for HTTP, and 443 for HTTPS.

URLs may also be relative to a resource.

    /pathToScript/myScript.php

    test.ashx?uid=129

## REST

Representational state transfer (REST)

1. Requests and responses contain representations of the current state of the system’s resources
1. Rest-Style URLS usually means that instead of putting in queries within the query string, they are put in the file path.

    http://wahh-app.com/search?make=ford&model=pinto
    
    http://wahh-app.com/search/ford/pinto

## HTTP Headers In-depth

There are a lot of headers in HTTP, many may be used for attacking web applications. They are categorized into groups

### General Headers

- **Connection:** 
    - Tells the other end of the communication whether to close the TCP connection after HTTP transmission was done or stay open
- **Content-Encoding:** 
    - Specifies the encoding is being used such as gzip.
- **Content-Length:** 
    - Specifies length of message body in bytes (except with head requests)
- **Content-Type:**
    - Specifies type of content contained in body such as text/html
- **Transfer-Encoding:**
    - Specifies any encoding that was performed on the messege body. (Normally used to specify chunked encoding when employeds)

### Request Headers

- **Accept:**
    - Tells server what content client is willing to accept, like image types
- **Accept-Encoding:**
    - Tells server what kind of content encoding the client is willing to accept.
- **Authorization:**
    - Submits creds to the server for a built-in HTTP auth type
- **Cookie:**
    - Submits cookies to the server previously issued.
- **Host:**
    - Specifies hostname from the full URL
- **If-Modified-Since:**
    - Specifies last time browser recieved the resource, if the resource hasn't changed since that time, the server may instruct the client to use a cached copy.
- **If-None-Match:**
    - Specifies <i>entity tag</i> thich is an identifier that denotes the contents of the message body. The browser submits the entity tag that the server issued with the requested resource when it was last received. The server then uses the tag to find out if the browser can use a cached copy.
- **Origin:**
    - Used in cross-domain AJAX requests to specify which site the request originated.
- **Referer:**
    - Specifies URL from where the request originated.
- **User-Agent:**
    - Provides info on the browser.

### Response Headers

- **Access-Control-Allow-Origin:**
    - Indicates whether resource can be retrieved from a cross-domain AJAX request.
- **Cache-Control:**
    - Passes caching directives to the browser.
- **ETag:**
    - Entity Tag. Clients can submit the identifier in the future for the same resource in the If-None-Match header to notify the server which version of the resource the browser has.
- **Expires:**
    - Tells the browser how long the contents of the message body are valid for. Thus the browser could use a cached version until that time.
- **Location:**
    - Used in redirection responses (the ones that are 3xx) to specify the target of the redirect.
- **Pragma:**
    - Gives caching directives to the browser (no-cache)
- **Server:**
    - Provides info about the web server software used.
- **Set-Cookie:**
    - Issues cookies to the browser that it will submit back to the server in later requests.
- **WWW-Authentication:**
    - Used in responses that have a 401 status code to provide details on the type(s) of auth that the server supports.
- **X-Frame-Options:**
    - Indicates whether and how the current response may be loaded within a browser frame.

## Cookies

The cookie mechanism enables the server to send items of data to the client, which the client then submits back to the server in requests.

Cookies are a unique type of parameter that will be resubmitted in each subsequent request without any action required.

For a server to issues a cookie, it will use a Set-Cookie response header

    Set-Cookie: tracking=oAjNrgaSo83aSdfgagr3

The user that recieves this cookie will automatically add the following header to subsequent requets back to the same server.

    Cookie: tracking=oAjNrgaSo83aSdfgagr3

Cookies normally follow a certain format that goes by a name/value pair. Multiple cookies can be issued together, they will be in the same response header with each cookie being seperated by a semicolon.

Cookies also can have optional attributes:

- **expires:**
    - Sets date until the cookie is valid. This means that the browser will store until the cookie is no longer valid. If this isn't used, then the cookie is defaulted to the browser session.
- **domain:**
    - Specifies the domain for which the cookie is valid. This must be the same or a parent of the domain from which the cookie was received.
- **path:**
    - Specifies URL path for which cookie is valid
- **secure:**
    - If attribute is set, the cookie will only be sent via HTTPS
- **HttpOnly:**
    - If attribute is set, the cookie cannot be directly accessed via client-side JavaScript.

## Status Codes

Every HTTP response must contain a status code in its first line. There are five categories of status code:

- 1xx: Informational
- 2xx: Request was successful
- 3xx: Client was redirected to different resource
- 4xx: Request contains error
- 5xx: Server encountered error

There are some common status code that are useful

- 100 Continue
    - Sent in some circumstances when a client submits a request containing a body.
- 200 OK
    - Indicates the request was successful and that the request body contains the result of the request.
- 201 Created
    - Returned in response to a PUT request to indicate that the request was successful.
- 301 Moved Permanently
    - Redirects browser permanently to a different URL, which is specified in the Location header. The Client should use the new URL in the future over the original
- 302 Found
    - Redirects the browser temporarily to a different URL, specified in the Location header. The client should revert to the original URL in the future.
- 304 Not Modified
    - Instructs browser to use its cached copy of the requested resource.  The server uses the If-Modified-Since and If-None-Match request headers to determine whether the client has the latest version of the resource.
- 400 Bad Request
    - Indicates that the client submitted an invalid HTTP request.
- 401 Unauthorized
    - Indicates that the server requires HTTP Auth. The WWW-Authentication header contains details on the type of auth supported.
- 403 Forbidden
    - Indicates that no one is allowed to access the resource.
- 404 Not Found
    - Indicates that the requested resource doesn't exist.
- 405 Method Not Allowed
    - Indicates that the method used in the request is not supported for the URL.
- 413 Request Entity Too Large
    - If probing for buffer overflows in native code, the submitted string may be too long and you will get this.
- 414 Request URI Too Long
    - URL is too long to process.
- 500 Internal Server Error
    - Indicates that the server encountered an error. Usually caused by giving unexpected input that caused an unhandled error within the application's proccess. (read response this carefully for details indicating nature of error)
- 503 Service Unavailable
    - Normally means that the web server isn't responding to requests. (You should verify that you didn't cause this)


## HTTPS

This is HTTP with encryption. The encryption is TLS, but is often called by the technology previously used which is SSL. That's why you often see SSL/TLS.

## HTTP Proxies

This is a middleman in traffic from the browser to the server. It has to be set up to do so though.

HTTP works differently when working with a proxy server in two ways.

- With an HTTP request, it will send the full URL, with server's hostname, and port number if nonstandard. The proxy will then extract the hostname and port to direct to the correct destination server.
- With an HTTPS request, the browser cannot perform the SSL handshake with the proxy server. So, for the SSL handshake to occur, the first process is for the browser to make an HTTP request with the CONNECT method and specifies the destination hostname and port. If the proxy allows the request, then from that point on acts as a TCP-Level relay and Allows the SSL handshake to occur(?)

## HTTP Authentication

HTTP supports a couple ways for authenticating. The 3 basic ways to perform this is:

1. Basic
    - A simple auth mechanism that sends user creds as base64 encoded strings in a request header with each method
1. NTLM
    - A challenge-response mechanism and uses a version of the Windows NTLM protocol.
1. Digest
    - a challenge-response mechanism and uses MD5 checksums of a nonce with a user's creds.

These aren't commonly deployed nowadays, but there a little more prevelant within organizations to access intranet-based services.

## Same Origin Policy

Mechanism implemented within browsers that is used to keep content that came from different origins from interfering with each other. 

This means that content received from one site is allowed to read an modify other content received from the same site but is not allows to access content recieved from other sites. Thus if a user visits site1 and then to site2, site1 may collect data from site2 and this means there could be certain types of attacks. Be sure to note:

- A page residing on a domain can create an arbitrary request to another domain, but it cannot process the data returned from that request.
- A page residing on one domain can load a script from another domain and execute this within its own context. This is due to scripts being assumed to contain code, rather than data, so cross-domain access shouldn't lead to disclosure of anything sensitive.
- A page residing on one domain cannot read/modify cookies or other DOM data on another domain.

## Encoding Schemes

### URL Encoding

URLs are permitted to only contain printable characters in the US-ASCII character set (0x20 - 0x7e). There are also some characters that are restricted in this range as they have a special meaning within the HTTP protocol.

The URL encoding scheme is used for safe transportation of problematic characters. The form that you will see within a URL encoding scheme is % followed by a 2 digit ascii code(in hex). Common ones include:

    %3d     =
    %25     %
    %20     Space
    %0a     New Line
    %00     Null Byte

You should URL-encode these characters whenever inserting them as data: (space, %, ?, &, ;, +. #). 

### Unicode Encoding

Unicode Encoding is rather similar to URL-Encoding. It is 16-bit, compared to ASCII's 7 bit. It starts with a prefix of %u, just like the prefix of %. Finally, it is expressed in hex:

    %u2215      /
    %u00e9      é

UTF-8 is variable-length encoding, as it supports many more bits for different applications. Within web hacking, it is greatly of use because of its ability to sometimes defeat input validation mechanisms.

### HTML Encoding

HTML encoding is used when certain characters are problematic. Often times, these are characters that are important to the HTML language. Within web pentesting, they are usually used within probing for XSS vulns. So if testing and the application returns user input unmodified within its response, it may be vulnerable, if the dangerous characters are HTML-Encoded, then is may be safe.


    &quot;      "
    &apos;      '
    %amp;       &
    %lt;        <
    %gt;        >

    #There is also dec based HTML Encodings
    &#34;       "
    &#39;       '

    #Also hex based HTML Encoding
    &#x22;      "
    &#x27;      '


### Base64 Encoding

Base 64 is encoding in just that, it is usally for transporting special data, such as creds.

### Hex Encoding

Hex is just base16.

### Remote and Serialization Frameworks

There are frameworks that have come out that allow developers to closely develop in a nature that is like that of desktop application. They usually give the developer APIs and thus the developer uses them.











